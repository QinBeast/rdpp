


## X224传输层协议握手

客户端发送自己支持的传输层协议类型:RDP、SSL、NLA。服务端收到后根据自己支持的协议
类型计算出一个最终采用的协议发送给客户端。

- 如果协议类型是RDP，什么也不做，继续MCS层握手
- 如果协议类型是SSL，则进行TLS握手，并用TLS传输接下来的数据包。
- 如果协议类型是NLA，先启动SSL协议过程，然后启动CredSSP身份验证过程，验证用户名
  和密码是否合法，librdpp支持NTLMv2的认证协议。

### MCS层多通道握手

这里的握手完成两件事情：

1. 逐一确定启动的通道数量
2. 确定Sec层使用的加密方式

### Sec加解密层握手

#### sendClientRandom

发送客户端的32位随机数


RC4密钥计算过程：

fn(客户端随机数，服务端随机数) = (key1, key2)


客户端:使用key1加密待发送的数据, key2解密收到的数据
服务端:使用key2加密待发送的数据, key1解密收到的数据


密钥更新：

每隔4096个数据包，根据当前密钥，计算出一个新的密钥，并采用新的密钥加解密数据，



### PDU数据层，Capability握手



## FastPath数据

FastPath类型的数据经过tkpt层 -> sec层 -> pdu层路径传递数据，目前只用来传输
以下两类数据:

1.服务端的图像更新数据。
2. 客户端的输入数据。














